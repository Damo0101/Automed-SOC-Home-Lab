SOC Automation Home Lab (Damin Mohsin) 
Overview: 
My SOC Automation Home Lab demonstrates how a security operations center (SOC) can be built using 
open source tools while achieving high level automation and incident response. The lab uses a Windows 
client instrumented with Sysmon to generate rich telemetry, a Wazuh manager for ingesting logs and 
generating alerts, Shuffle as a security orchestration, automation and response (SOAR) platform, and 
TheHive for case management. Events generated by Sysmon on the Windows endpoint are forwarded to 
Wazuh where custom rules detect malicious activity (Mimikatz credential dumping). Wazuh forwards 
matching alerts to Shuffle via a webhook; Shuffle runs a playbook that enriches the alert with threat 
intelligence (VirusTotal), creates a case in TheHive, and notifies analysts via email. This deliverable 
report documents the architecture, data pipeline, detection engineering, automation workflows, testing 
methodology, metrics, incident response operating model, governance requirements, lessons learned and 
future enhancements. 
Objectives 
1. Hands-on SOC experience – provide a realistic lab where professional analysts install and 
configure modern security tooling, simulate responses to local activity, tune detections, and 
respond to incidents in an efficient manner. 
2. Tool familiarisation – integrate Wazuh, Sysmon, Shuffle, TheHive and VirusTotal to understand 
how each component contributes to detection, enrichment and case management. Base 
understanding allows for replacement of relevant tools in the future such as Splunk, Catalyst, etc. 
3. Detection engineering – create custom Wazuh rules mapped to MITRE ATT&CK (e.g., T1003) 
and test them against Mimikatz to demonstrate detection logic. 
4. SOAR automation – build Shuffle workflows that extract indicators, enrich them using threat 
intelligence, open alerts in TheHive and automate notifications to help reduce SOC fatigue and 
improve efficiency. 
5. Incident response readiness – follow NIST SP 800‑61 guidance for preparation, detection, 
analysis, containment and recovery. 
System Architecture 
The architecture consists of a Windows 10 client generating events, a Wazuh server performing log 
ingestion and alerting, Shuffle orchestrating automation, TheHive providing case management, and email 
for analyst notifications. This illustrative diagram depicts data flow and response loops. 
The architectural diagram is provided in the final deliverable. Events from the Windows client are sent to 
Wazuh (1); Wazuh generates alerts (2) and forwards them to Shuffle via a webhook (3). Shuffle enriches 
indicators (4) and sends alerts to TheHive (5) and to analysts via email (6). Analysts triage in TheHive 
and, if required, initiate response actions through Shuffle (7), which instructs Wazuh to perform endpoint 
remediation (8). 
Components 
Component 
Windows Client 
(Wazuh agent) 
Wazuh 
Manager/Indexer 
Shuffle SOAR 
TheHive 
Email Server 
Role & Deployment 
A Windows 10 VM with Sysmon installed via 
Sysmon64.exe -i sysmonconfig.xml. Sysmon 
logs process creation, file events and network 
connections, sending them to Wazuh using an 
installed Wazuh agent. 
Deployed on Ubuntu 22.04 (8 GB RAM, 50 
GB disk) using the official installation script. 
Responsible for parsing Sysmon logs, applying 
rules and generating alerts. Includes Filebeat, 
Elasticsearch and a dashboard. 
A cloud hosted instance of Shuffle 
(shuffler.io). Receives Wazuh alerts via 
webhook, executes workflows for indicator 
extraction, enrichment, case creation and 
notifications. 
Case management platform installed on 
Ubuntu using the StrangeBee repository. 
Backed by Cassandra and Elasticsearch; 
accessible via port 9000 with default 
credentials admin@thehive.local/secret. 
Shuffle uses built in SMTP integration to send 
alert notifications to analysts. 
Key configuration 
Sysmon configuration tuned 
for comprehensive event 
logging; Wazuh agent 
configured to forward logs to 
the manager. 
ossec.conf configured to 
archive all logs 
(logall/logall_json) and to 
integrate with Shuffle via a 
webhook. Custom rule file 
(local_rules.xml) contains 
detection logic. 
Workflow created with a 
webhook trigger; nodes 
configured for regex 
extraction, VirusTotal API, 
TheHive integration and 
email. Wazuh integration uses 
rule ID 100002 to only 
forward Mimikatz alerts. 
Organisations and users 
created; API key generated for 
Shuffle integration. Alerts 
from Shuffle automatically 
create cases with tags (e.g., 
MITRE T1003) and severity. 
Email node configured with 
recipient, subject and body; 
connected to other workflow 
nodes. 
Network & Security Considerations 
Servers are deployed on separate DigitalOcean droplets with firewalls restricting SSH access to the 
analyst’s IP and exposing only necessary ports (443 for Wazuh dashboard, 9000 for TheHive). The 
Shuffle platform is hosted in the cloud and communicates over HTTPS. Agents authenticate to Wazuh 
using registration keys; TheHive uses API keys for Shuffle. TLS certificates should be provisioned in 
production to secure communications. 
Data Ingestion and Logging Pipeline 
Sysmon and Wazuh 
Sysmon provides high fidelity telemetry on the Windows client, logging process creation, file 
modifications, and network events. After installation, the Wazuh agent forwards Sysmon logs to the 
Wazuh manager. In the manager’s configuration, the <localfile> directive is set to monitor Sysmon logs, 
and logall/logall_json flags enable full archive indexing. Filebeat ships archived logs to Elasticsearch for 
long term retention. The Wazuh dashboard allows analysts to query logs, while the manager runs alert 
rules against incoming events. 
Custom Rule & MITRE Mapping 
Detection engineering is accomplished by creating a custom Wazuh rule to detect Mimikatz execution. A 
rule with ID 100002 watches for Sysmon event group sysmon_event1 and matches the 
win.eventdata.originalFileName field using a case‑insensitive regular expression for mimikatz.exe. The 
rule assigns a high severity level (15) and maps to MITRE ATT&CK technique Credential Dumping 
(T1003). The rule is placed in local_rules.xml and loaded via the Wazuh manager interface. 
Alert Forwarding 
To send alerts to Shuffle, an <integration> block is added to ossec.conf specifying the Shuffle webhook 
URL, alert format json, and either level or rule_id to filter which alerts are sent. The manager uses this 
integration to POST matching alerts to Shuffle for further processing. This decouples alert generation 
from orchestration logic and allows selective forwarding based on rule IDs (e.g, only Mimikatz alerts). 
Wazuh also maintains archive logs for forensic investigations and correlation. 
Detection Engineering and MITRE ATT&CK Mapping 
Detection logic is central to the lab. The custom rule described above demonstrates how to detect 
Credential Dumping irrespective of the executable’s filename. Testing shows that renaming the Mimikatz 
binary to notepad.exe still triggers the alert due to the originalFileName field containing mimikatz.exe. 
This approach reduces false negatives by leveraging metadata rather than file names. The rule maps to 
MITRE ATT&CK ID T1003, enabling standardised reporting and correlation across tools. 
Additional detection opportunities include monitoring for abnormal registry modifications, LSASS access 
patterns, or anomalous PowerShell usage. By utilising Sysmon event IDs and Wazuh’s rule groups, 
detections can be built for multiple ATT&CK techniques. Each detection should include severity, 
description, MITRE IDs and context to support triage and automation. 
SOAR Automation Workflows 
Workflow Overview 
Shuffle orchestrates the response to Wazuh alerts. The workflow comprises the following steps: 
1. Webhook Trigger – Shuffle receives a JSON alert via the webhook configured in Wazuh and 
extracts the alert data. 
2. Regex Extraction – A node uses a regular expression SHA256=([0-9A-Fa-f]{64}) to parse the 
SHA‑256 hash from the alert’s hashes field. Extracting just the 64‑character hash avoids invalid 
queries when sending to VirusTotal. 
3. VirusTotal Enrichment – The workflow calls the VirusTotal v3 API, supplying the extracted 
hash. The response includes the file’s reputation score and detection counts, enabling threat 
context. 
4. TheHive Alert Creation – Shuffle authenticates to TheHive using an API key and issues a create 
alert action. The JSON payload contains fields such as title, severity, summary, external link, 
TLP/PAP values, MITRE tags (e.g., T1003), and sourceRef referencing Wazuh rule 100002. 
Analysts receive a new alert with enriched context. 
5. Email Notification – An email node composes a message to the SOC analyst summarising the 
alert (e.g., host name, hash, VirusTotal detections) and sends it via SMTP. 
6. Optional Response Action – If configured, Shuffle can call back into Wazuh using the 
wazuh-agent API to quarantine the malicious file or execute a remediation script. This step 
demonstrates closed‑loop automation 
Implementation Notes 
The workflow is built in Shuffle’s drag and drop interface. Each node is configured with environment 
specific values such as API keys and URLs. The Regex capture group is used instead of default mode to 
correctly extract the hash. The VirusTotal node must be authenticated via a per user API key. The 
TheHive node’s payload can include additional fields like observables ( the SHA‑256 hash) or tags with 
ATT&CK IDs for better correlation. When selecting severity, use a consistent mapping (detection severity 
2 for high risk). The email node should include context that enables triage without logging into the 
dashboard, such as host, process, MITRE technique and enrichment results. 
Testing and Red Team Simulation 
Test Scenario 
To validate the detection and automation pipeline, a red‑team simulation is executed using the 
credential‑dumping tool Mimikatz. The binary is renamed (e.g., to notepad.exe) and executed on the 
Windows host. Despite the name change, the custom Wazuh rule triggers because it matches the original 
file name metadata in the Sysmon event. Wazuh generates an alert with severity 15, which is forwarded to 
Shuffle via the webhook. 
Shuffle receives the alert, extracts the SHA‑256 hash, queries VirusTotal, and creates an alert in TheHive 
with MITRE ID T1003. The SOC analyst receives an email notification containing the host name and the 
VirusTotal detection count. In TheHive, the analyst can view the alert details, evidence, and enrichment 
results. This simulation confirms end‑to‑end functionality: detection, enrichment, case management and 
notification. 
Additional Testing 
Beyond Mimikatz, the lab should simulate other ATT&CK techniques such as lateral movement 
(Pass‑the‑Hash), privilege escalation via SeDebugPrivilege, and persistence using run keys. Each 
simulation should follow a structured testing methodology: generate telemetry, tune detection rules, verify 
alert forwarding, confirm enrichment results, and measure response times. Attack simulation tools like 
Atomic Red Team or Caldera can automate these scenarios. 
Metrics and Key Performance Indicators (KPIs) 
Effective SOC automation requires measurement. Two critical metrics are Mean Time to Detect (MTTD) 
and Mean Time to Respond (MTTR). High performing organizations aim for MTTD between 30 minutes 
and 4 hours according to prophetsecurity.ai. In this lab, the pipeline achieved detection within seconds of 
executing Mimikatz due to real time Sysmon logging and Wazuh alert generation. MTTD should be 
calculated by subtracting the event start timestamp from the alert creation timestamp. 
MTTR measures the time from detection to containment or resolution. Industry benchmarks range 
between 2 and 4 hours. The automation workflow reduces MTTR by immediately enriching indicators, 
creating cases and notifying analysts helping reduce MTTR by hours. Response actions (e.g., quarantining 
the malicious binary) can further reduce MTTR by executing automatically after analyst approval. Other 
useful KPIs include: 
● Alert Volume Reduction – Track how many alerts are suppressed or automatically closed due to 
enrichment indicating benign activity. 
● SOAR Workflow Success Rate – Percentage of alerts successfully processed through Shuffle 
without errors. 
● Case Creation Latency – Time from Wazuh alert to TheHive case creation. 
● False Positive Rate – Proportion of alerts that do not represent true malicious activity; this 
informs tuning of detection rules. 
Incident Response Operating Model 
The operating model aligns with NIST SP 800‑61 r3 and the Cybersecurity Framework 2.0. Table 1 
maps the lab’s activities to the NIST lifecycle phases 
NIST Phase 
Preparation 
Detection & 
Analysis 
Containment, 
Eradication & 
Recovery 
Post‑Incident 
Activity 
Incident Response Process 
Lab Implementation 
Build VM infrastructure; install Sysmon, Wazuh 
and TheHive; develop custom detection rules; 
configure Shuffle workflows; define 
communication channels; generate API keys. 
Monitor Sysmon telemetry; Wazuh applies rules 
and generates alerts; Shuffle enriches alerts and 
creates cases in TheHive. Analysts triage alerts 
and determine if an incident has occurred. 
If an alert represents an incident, the analyst can 
trigger a response action through Shuffle. This 
may involve quarantining a file, disabling a user 
account, or collecting memory. After 
containment, the system is restored to normal 
operation. 
Lessons learned captured in TheHive case 
post‑mortems; detection rules and workflows 
updated; metrics reviewed to improve 
MTTD/MTTR. 
CSF 2.0 Function 
Govern, Identify, Protect 
Detect 
Respond, Recover 
Identify (Improvement) 
1. Preparation – Document roles and responsibilities; maintain an incident response plan; configure 
logging, detection rules and automation workflows. Ensure backups and snapshots for VMs. 
Provide analysts with training on Wazuh, Shuffle and TheHive. 
2. Identification – When Wazuh raises an alert, the SOC determines whether it indicates malicious 
activity. Shuffle’s enrichment accelerates this decision by providing VirusTotal scores and 
additional context. 
3. Containment – Upon confirmation, the SOC analyst triggers an automated remediation via 
Shuffle, such as isolating the host, killing the malicious process, or blocking the offending hash 
via Wazuh integration. Containment actions should be documented in TheHive. 
4. Eradication – Remove persistence mechanisms and malicious files. Verify the host is clean; 
update detection rules if new IOCs are discovered. 
5. Recovery – Restore the system to normal operations. Re‑enable services and monitor for 
re‑infection. 
6. Lessons Learned – Conduct a post incident review. Update playbooks, detection rules and 
automation workflows to address any gaps identified. 
Roles and Responsibilities (For those implementing this workflow professionally) 
● SOC Analyst – Monitors alerts, triages cases in TheHive, validates enrichment data, escalates 
incidents and executes response actions. Documents findings in the case record. 
● SOAR Engineer – Maintains Shuffle workflows, ensures integrations work, tunes automation to 
reduce false positives and improves reliability. 
● Detection Engineer – Develops and maintains Wazuh rules, maps detections to MITRE 
ATT&CK, and ensures coverage across ATT&CK techniques. Works with threat intelligence to 
improve context. 
● Incident Response Lead – Coordinates response activities, communicates with stakeholders, and 
ensures compliance with regulatory notification requirements. 
● Management and Compliance – Reviews metrics, approves changes to the incident response 
plan, and ensures alignment with NIST, NYDFS and internal policies. 
Lessons Learned and Future Enhancements 
Lessons learned from building and testing the SOC Automation lab include: 
● High fidelity telemetry is essential. Sysmon provides rich event data that supports effective 
detection, but it must be configured properly and monitored to avoid overwhelming storage. 
● Customization reduces false negatives. Matching on the originalFileName field ensures 
detection of renamed binaries, illustrating the importance of looking beyond process names. 
● Automation accelerates response. Integrating Wazuh, Shuffle, VirusTotal and TheHive delivers 
near real‑time enrichment and case creation, reducing manual effort and improving MTTR. 
● Documentation and governance matter. Aligning the lab with NIST like frameworks ensures 
that automation does not sacrifice compliance and that incident response processes remain 
auditable. 
Future enhancements: 
1. Expand detection coverage by developing additional Wazuh rules for other ATT&CK 
techniques, including lateral movement and privilege escalation. Integration of additional sensors 
such as Zeek for network telemetry or Sigma for rule portability could enhance detection quality. 
2. Integrate additional enrichment sources (e.g., AbuseIPDB, AlienVault OTX) to provide 
broader context in Shuffle workflows. 
3. Implement user feedback loops within Shuffle to allow analysts to mark false positives; use this 
data to retrain detection thresholds or update rules. 
4. Automate containment by integrating Wazuh with endpoint management tools (e.g., WinRM or 
SSH) to quarantine or remediate hosts automatically when certain conditions are met, subject to 
analyst approval. 
5. Deploy continuous testing using frameworks like Atomic Red Team to regularly simulate 
ATT&CK techniques, validate detections, and measure MTTD/MTTR. 
Current Playbooks 
● Credential Dumping (T1003) – Triggered by Wazuh rule 100002 when Sysmon detects 
mimikatz.exe. Shuffle enriches the alert, opens a case in TheHive, and notifies analysts. Response 
actions may include isolating the host and resetting affected credentials. 
● Malicious PowerShell – (Future) Monitor powershell.exe command lines for suspicious flags; 
rule triggers when encoded commands or AMSI bypass patterns appear. Shuffle queries 
threat‑intel for script hash, raises case with MITRE T1086 tag and instructs endpoint to terminate 
process. 
● Persistence via Run Keys – (Future) Detect creation of 
HKCU\Software\Microsoft\Windows\CurrentVersion\Run values. Workflow extracts registry 
path, looks up known persistence keys, sends to TheHive, and optionally removes the registry 
value. 
By following these playbooks and continuously iterating on detections, automation and governance, the 
SOC Automation Lab serves as a robust reference architecture for building a modern, automated SOC. 
RESOURCES 
SIEM & endpoint collection 
● Wazuh Documentation (official) — installation, agent setup, alert rules, manager/integration 
guidance. Wazuh Documentation+1 
● Wazuh (product site) — overview, features, and community resources for Wazuh SIEM/XDR. 
Wazuh 
Case management / analyst tooling 
● TheHive (official docs / StrangeBee) — TheHive 5 documentation and guides for case 
management and Cortex analyzers/responders. StrangeBee Docs+1 
SOAR / automation 
● Shuffle (Shuffle.io) — Documentation & Tutorials — official Shuffle docs and 
self-hosted/cloud setup guides for building SOAR playbooks. Shuffler+1 
Threat intel platforms 
● MISP — Official documentation (misp-book / install guides) — full install, API, and 
operational guidance for sharing IOCs and TI. MISP Threat Intelligence+1 
Network detection & monitoring 
● Security Onion — Documentation — deployment, Suricata/Zeek integration, dashboards, and 
SOC operations guidance. Security Onion Documentation+1 
● Suricata — Official documentation (user guide & rules) — IDS/NSM engine docs, rule 
management, EVE output formats and tuning guidance. Suricata Documentation+1 
Log shipping & Elastic stack 
● Filebeat / Elastic Stack docs (official) — Filebeat installers, modules, parsing, and tips to ship 
logs to Elasticsearch/Kibana. Elastic+1 
Standards, frameworks & playbooks 
● MITRE ATT&CK & ATT&CK Navigator — canonical framework and the Navigator tool for 
mapping detections to techniques; great for producing the ATT&CK layer image for your report. 
MITRE ATT&CK+1 
● NIST SP 800-61 Rev. 3 (Incident Response) — authoritative IR lifecycle and playbook 
guidance (useful for runbook alignment and governance language). NIST Publications 
● CISA — Federal Cybersecurity Incident & Vulnerability Response Playbooks (PDF) — 
standardized playbook templates and notification flow guidance. CISA 
Enrichment & external-lookup APIs 
● VirusTotal API (v3) — Documentation — API reference for file/URL/domain reputation 
enrichment used in SOAR playbooks. VirusTotal Docs+1 
● Passive DNS / PassiveTotal / SecurityTrails docs — passive DNS and historical WHOIS/DNS 
data providers for enrichment (useful for playbook enrichment steps). PassiveTotal+1 
